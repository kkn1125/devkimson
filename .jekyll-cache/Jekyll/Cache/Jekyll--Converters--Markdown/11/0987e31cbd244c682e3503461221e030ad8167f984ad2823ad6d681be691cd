I"#<h1 id="spring-boot말고-spring에서-jpa를-사용해보자">Spring Boot말고 Spring에서 JPA를 사용해보자</h1>

<p>이번에는 <code class="language-plaintext highlighter-rouge">JPA</code>를 <code class="language-plaintext highlighter-rouge">Spring</code>에서 사용하는 방법을 기록하려합니다. 대부분의 블로그가 <code class="language-plaintext highlighter-rouge">Spring Boot</code>를 기준으로 설명되어 있어 <code class="language-plaintext highlighter-rouge">Spring Framework</code>로 <code class="language-plaintext highlighter-rouge">JPA</code>를 구현하는데 조금 어려움을 겪다가 결국 <code class="language-plaintext highlighter-rouge">Spring</code>공식 홈페이지 등을 통해 원문을 읽어가며 작동은 시켰습니다.</p>

<h2 id="필요한-설정">필요한 설정</h2>

<blockquote class="blockquote blockquote-info">
  <p>필요한 <code class="language-plaintext highlighter-rouge">Dependency</code>를 먼저 연결합니다.<br />
사용된 내용은 아래와 같습니다.</p>
</blockquote>

<ol>
  <li><code class="language-plaintext highlighter-rouge">spring-data-jpa</code> → <code class="language-plaintext highlighter-rouge">2.4.8</code> (<code class="language-plaintext highlighter-rouge">springframework</code>를 <code class="language-plaintext highlighter-rouge">5.3.6</code>으로 사용한다면 <code class="language-plaintext highlighter-rouge">2.4.8</code>로 맞춰야 작동합니다.)</li>
  <li><code class="language-plaintext highlighter-rouge">hibernate-core</code> → <code class="language-plaintext highlighter-rouge">5.3.6.Final</code></li>
  <li><code class="language-plaintext highlighter-rouge">javax.persistence-api</code> → <code class="language-plaintext highlighter-rouge">2.2</code></li>
  <li><code class="language-plaintext highlighter-rouge">mysql-connector-java</code> → <code class="language-plaintext highlighter-rouge">8.0.23</code></li>
  <li><code class="language-plaintext highlighter-rouge">spring-jdbc</code> → <code class="language-plaintext highlighter-rouge">5.3.6</code></li>
  <li>lombok → <code class="language-plaintext highlighter-rouge">1.18.22</code></li>
</ol>

<p><code class="language-plaintext highlighter-rouge">lombok</code>은 선택사항입니다.</p>

<h2 id="코드-작성">코드 작성</h2>

<p>데이터베이스는 적당히 간단한 예제로 준비했습니다.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre><span class="k">create</span> <span class="k">database</span> <span class="n">test</span><span class="p">;</span>

<span class="n">use</span> <span class="n">test</span><span class="p">;</span>

<span class="k">create</span> <span class="k">table</span> <span class="n">member</span><span class="p">(</span>
	<span class="n">mbr_no</span> <span class="nb">bigint</span> <span class="k">not</span> <span class="k">null</span> <span class="n">auto_increment</span><span class="p">,</span>
    <span class="n">id</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">200</span><span class="p">),</span>
    <span class="n">name</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">200</span><span class="p">),</span>
    <span class="k">primary</span> <span class="k">key</span><span class="p">(</span><span class="n">mbr_no</span><span class="p">)</span>
<span class="p">)</span><span class="k">default</span> <span class="n">charset</span><span class="o">=</span><span class="nv">"UTF8"</span><span class="p">;</span>

<span class="k">insert</span> <span class="k">into</span> <span class="n">member</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="k">values</span> <span class="p">(</span><span class="nv">"kimson01"</span><span class="p">,</span><span class="nv">"kimson1"</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">member</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="k">values</span> <span class="p">(</span><span class="nv">"kimson02"</span><span class="p">,</span><span class="nv">"kimson2"</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">member</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="k">values</span> <span class="p">(</span><span class="nv">"kimson03"</span><span class="p">,</span><span class="nv">"kimson3"</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">member</code>테이블을 만들어 <code class="language-plaintext highlighter-rouge">JPA</code>가 잘 연결되고 잘 작동되는지가 목표입니다.</p>

<h3 id="config-구현">Config 구현</h3>

<p>저는 기존에 <code class="language-plaintext highlighter-rouge">RootConfig</code>라는 <code class="language-plaintext highlighter-rouge">dataSource</code>를 <code class="language-plaintext highlighter-rouge">Bean</code>으로 등록하는 <code class="language-plaintext highlighter-rouge">Configuration</code>을 사용합니다.</p>

<p>기존에 <code class="language-plaintext highlighter-rouge">MyBatis</code>를 쓸 때 또는 <code class="language-plaintext highlighter-rouge">JDBC</code>사용 시 코드 형태는 아래와 같습니다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre><span class="nd">@Configuration</span>
<span class="nd">@ComponentScan</span><span class="o">(</span><span class="s">"com.springtest.web"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RootConfig</span><span class="o">{</span>
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">DataSource</span> <span class="nf">dataSource</span><span class="o">(){</span>
        <span class="nc">DriverManagerDataSource</span> <span class="n">mysql</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DriverManagerDataSource</span><span class="o">();</span>
        <span class="n">mysql</span><span class="o">.</span><span class="na">setDriverClassName</span><span class="o">(</span><span class="s">"com.mysql.cj.jdbc.Driver"</span><span class="o">);</span>
        <span class="n">mysql</span><span class="o">.</span><span class="na">setUrl</span><span class="o">(</span><span class="s">"jdbc:mysql://localhost:3306/test"</span><span class="o">);</span>
        <span class="n">mysql</span><span class="o">.</span><span class="na">setUsername</span><span class="o">(</span><span class="s">"yourName"</span><span class="o">);</span>
        <span class="n">mysql</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="s">"yourPass"</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">mysql</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<hr />

<p>📚 함께 보면 좋은 내용</p>

<p><a href="https://docs.spring.io/spring-data/jpa/docs/1.5.0.RELEASE/reference/html/jpa.repositories.html" target="_blank">DOCS Spring 2.JPA Repositories</a></p>

<p><a href="https://spring.io/projects/spring-data-jpa#samples" target="_blank">Spring.io 문서 - Book Example</a></p>

<p><a href="https://www.baeldung.com/the-persistence-layer-with-spring-and-jpa" target="_blank">odrotbohm - A Guide to JPA with Spring</a></p>

<p><a href="https://github.com/spring-projects/spring-data-book/blob/master/jpa/src/main/java/com/oreilly/springdata/jpa/core/CustomerRepository.java" target="_blank">Baeldung - spring-projects/spring-data-book</a></p>

<p><a href="https://github.com/eugenp/tutorials/blob/master/persistence-modules/spring-jpa-2/src/main/resources/hibernate5Configuration.xml" target="_blank">fdpro - Github Repository::tutorials</a></p>

<p><a href="https://araikuma.tistory.com/329" target="_blank">devkuma님 - [Spring] JpaRepository 이용</a></p>

<p><a href="https://goddaehee.tistory.com/209" target="_blank">갓대희님 - [스프링부트 (7)] Spring Boot JPA(1) - 시작 및 기본 설정</a></p>

<p><a href="https://data-make.tistory.com/621" target="_blank">Cristoval님 - [Spring + JPA] Spring Data JPA 란? (1)</a></p>
:ET