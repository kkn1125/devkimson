---
slug: "/podman01/"
layout: post
date: 2022-11-12 15:22:54 +0900
title: "[CONTAINER] Docker와 Podman"
author: Kimson
categories: [container]
image: /images/post/covers/TIL-podman.png
tags: [docker, container, image, podman]
description: ""
featured: true
hidden: false
rating: 4.5
toc: true
profile: false
istop: true
keysum: false
keywords: ""
published: true
---

<!-- 
1. docker란
	 - 역할과 목적, 기능
2. podman이란
	 - docker와 다른 점
3. podman을 선택한 이유
4. dockerfile을 이용한 이미지 빌드
5. podman command 조작
 -->

# Docker는 무엇인가

최근 회사 내부에서 새로운 서버 모델 제안으로 podman이라는 컨테이너화 도구를 스터디하는 기회가 생겼습니다.

스타트업의 성격상 이것저것 시도하고 적용하는 노력 등이 개인적으로 도움이 많이 되는 것 같아 기분이 좋습니다. 다만 너무 새로운 것을 추구하는 것 아닌가 하는 생각이 듭니다. 항상 새로운 것이 좋은 스펙을 가졌다 해서 모든 상황에 적합한 것은 아니니까요.

각설하고, podman을 알아보기에 앞서 docker에 대해 간략하게 짚고 넘어가려 합니다.

## Docker는 어떤 기능을 가지는가

도커는 리눅스 응용 프로그램들을 `프로세스 격리 기술`을 통해 컨테이너로 실행하고 관리하는 `오픈 소스 프로젝트`입니다.

<figure class="text-center">
<span class="w-inline-block">
   <img src="https://user-images.githubusercontent.com/71887242/201458999-9ca1a432-523d-488c-bc78-29a336ba2b38.png" alt="docker container" title="docker container">
   <figcaption>[출처] https://www.docker.com/resources/what-container/</figcaption>
</span>
</figure>

컨테이너는 코드, 종속성을 모두 패키징하는 앱 계층 추상화입니다. 컨테이너에 접속해서 명령어를 입력하거나 CPU와 메모리 사용량을 제한 할 수 있습니다. 또한 호스트의 특정 포트와 연결하는 포트포워딩 등이 가능합니다.

초기에 컨테이너와 이미지의 느낌이 와닿지 않았습니다. 추상적으로 다가왔기에 제가 이해한 `컨테이너`는 하나의 가상 운영체제이고, `이미지`는 실행가능한 애플리케이션의 집합 정도로 이해하고 있습니다. 이미지를 빌드하고, 컨테이너에 올려 가상 환경에서 해당 이미지를 실행시켜 서비스하는 느낌을 가지고 있습니다.

## Podman은 뭐지

포드맨은 리눅스 시스템에서 OCI 컨테이너를 개발, 관리 및 실행하기 위한 `데몬이 없는` 컨테이너 엔진이며 쿠버네티스와 유사한 접근 방식으로 컨테이너를 구축, 관리 및 실행하도록 설계된 Red Hat제품입니다. 컨테이너는 루트 또는 루트 없는 모드로 실행 가능하다고 합니다. 포드맨은 도커와 유사하며 dockerfile을 통해 이미지를 빌드하고 podman container에서 관리 가능합니다.

도커를 사용하지않고 바로 포드맨을 접했기 때문에 유사하다고만 알고 있는 상태라 더 자세한 내용은 추후에 스터디를 진행해서 포스팅을 조금씩 수정 할 계획입니다.

## Podman을 선택한 이유는

먼저 앞서 말한 이야기를 한 눈에 볼 필요가 있을 것 같습니다.

<figure class="text-center">
<span class="w-inline-block">
   <img src="https://user-images.githubusercontent.com/71887242/201459922-47156871-e164-4b4c-852e-abc62f66f1bf.png" alt="docker container" title="docker container">
   <figcaption>[출처] https://darumatic.com/blog/podman_introduction</figcaption>
</span>
</figure>

위 이미지를 보면 알기가 쉽습니다. 이미지와 커널, 컨테이너는 동일하지만 도커는 데몬을 통하고 포드맨은 데몬이 없는 형태로 구성되어 있습니다. 도커와 다른 점이라 하면 `데몬이 없다는`것을 강조하는데요, 예를 들면 리눅스 환경에서 service를 사용해서 start할 필요가 없다는 이야기가 됩니다. 포드맨이 도커보다 버그가 적다는 말이 있는데요, 그렇다고해서 포드맨이 버그가 아예 없는 것은 아니지만 도커 이미지와 호환이 되고 데몬이 없다는 장점과 도커와 거의 동일한 명령들이 있기 때문에 선택하게 되었다고 말할 수 있겠습니다.

물론 결정권을 가진 것이 아니기 때문에 위에서 내려온 선택지에 동의하거나 의문을 달 뿐이지요... 결정권자의 선택 이유를 1차원적으로 이해하자면 그렇습니다 🥲

## dockerfile 익히기

dockerfile에 대한 문법 등이 정리된 공식 홈페이지를 찾지 못해 구글링하며 모은 명령을 정리하겠습니다. 구글링하며 긁어온 정보라 잘못된 부분이 있을 수 있으니 어디까지나 참고만 하시는 것을 권장드립니다.

### 주로 사용하는 명령문

1. RUN
2. CMD
3. ENTRYPOINT
4. WORKDIR
5. EXPOSE
6. ENV

현재 제가 사용하는 명령이 6가지입니다. 그 외는 더 알아보고 추가할 것입니다.

먼저 `RUN`은 이미지 빌드하면서 실행되는 것인데요. `RUN` 뒤에 붙는 커멘드를 실행합니다.

```dockerfile
# 예제1
RUN echo 'hello kimson!'
```

이미지 빌드를 하면 echo 명령을 실행하면서 `hello kimson!`을 출력하게 됩니다. dockerfile을 이미지로 빌드하는 명령은 다음과 같습니다.

```bash
podman build -t test .
```

`podman build --help`를 입력하면 더 많은 옵션을 볼 수 있습니다. podman build는 이미지로 빌드하겠다는 명령이고, -t 옵션은 해당 이미지에 태그를 붙인다는 옵션입니다. 저는 test라는 태그를 붙였으며, 그 뒤에 오는 "."은 현재 터미널이 있는 디렉토리의 모든 파일을 빌드하겠다는 뜻 입니다.

다른 예로 우분투 20.04버전 이미지를 당겨와서 컨테이너로 접근하는 방법도 알아보겠습니다.

```dockerfile
podman pull ubuntu:20.04
```

입력하게 되면 아래와 같이 과정과 이미지 아이디가 출력됩니다.

<figure class="text-center">
<span class="w-inline-block">
   <img src="https://user-images.githubusercontent.com/71887242/201461262-9f431db4-e397-457b-a426-c58fe836a1f7.png" alt="docker container" title="docker container">
   <figcaption>command line</figcaption>
</span>
</figure>

그 다음 아래의 명령을 입력하면 터미널에서 커멘드 라인이 변경될 것입니다.

```bash
$ podman run -it docker.io/library/ubuntu:20.04
```

`nginx`나 `db`관련한 애플리케이션을 설정하고자 할 때는 `dockerfile`로 기본 세팅을 한 후 컨테이너에 접근해서 직접 파일을 수정하는 등의 과정을 거치면 됩니다. 간단한 예제로 `httpd`로 정적 웹사이트를 구동시키는 예를 보겠습니다.

단순하게 html에 hello world를 저장하고 dockerfile을 작성해서 컨테이너에 올려 실행, 중지하는 것을 관리하는 예제를 보고 마무리하겠습니다.

```dockerfile
FROM ubuntu:22.04

ENV NODE_VERSION=18.11.0
RUN apt-get update && apt-get install -y curl apache2
RUN curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
ENV NVM_DIR=/root/.nvm
RUN . "$NVM_DIR/nvm.sh" && nvm install ${NODE_VERSION}
RUN . "$NVM_DIR/nvm.sh" && nvm use v${NODE_VERSION}
RUN . "$NVM_DIR/nvm.sh" && nvm alias default v${NODE_VERSION}
ENV PATH="/root/.nvm/versions/node/v${NODE_VERSION}/bin/:${PATH}"
RUN npm install -g npm@9.1.1
RUN node --version
RUN npm --version

COPY . .

RUN npm install vite http-server -g
RUN npm install

RUN vite build --emptyOutDir

COPY ./dist/* /var/www/html/

# EXPOSE 80

CMD [ "/usr/sbin/apache2ctl", "-DFOREGROUND"]
```

저는 "우분투 22.04버전"을 사용하기 위해 "FROM"에 "ubuntu:22.04"를 입력했습니다. **FROM은 필수 값** 입니다.

`FROM`을 통해 지정한 기본 이미지를 생성하게 됩니다. `dockerfile`이 모두 작업을 끝내고 나면 `podman image list`를 통해 목록을 보면 `ubuntu:22.04` 이미지가 같이 있는 것을 볼 수 있습니다.



---

📚 함께 보면 좋은 내용

[디지털 가이드 - Podman vs Docker](https://www.ionos.com/digitalguide/server/know-how/podman-vs-docker/)

[Podman - Introduction](https://darumatic.com/blog/podman_introduction)

[Podman - Getting Started with Podman](https://podman.io/getting-started/)

[Dockerfile references](https://docs.docker.com/engine/reference/builder/)
