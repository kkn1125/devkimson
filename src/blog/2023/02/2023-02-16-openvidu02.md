---
slug: "/openvidu02/"
layout: post
date: 2023-02-16 00:38:21 +0900
title: "[WEBRTC] OpenVidu를 시작해보자 02"
author: Kimson
categories: [javascript]
image: /images/post/covers/TIL-javascript.png
tags: [javascript, webrtc, openvidu, media_server]
description: ""
featured: true
hidden: false
rating: 4.5
toc: true
profile: false
istop: true
keysum: false
keywords: ""
published: false
---

1. 이전 편 간략 설명
   1. 핵심 설명
2. 배포버전 설치
   1. 환경 설명
3. 백엔드 api to openvidu api
   1. openvidu 설정
   2. 백엔드 api 설정
4. front to 백엔드 api
   1. 백엔드 api 연결
   2. 튜토리얼 버전 모디파이
5. 추가로 필요한 것
   1. tls 설정
   2. 물리서버의 경우
   3. 클라우드서버의 경우
   4. 프론트 프레임워크에 대한 이해

# OpenVidu 배포 버전을 사용해보자

이전 포스팅에서는 openvidu-dev 컨테이너를 사용해서 로컬에서 테스트 환경을 구축하는 방법에 대해 알아보았는데요. 포스팅을 다듬을 시간이 없어 최대한 목차를 짜내어 글을 쓰고 있지만 여전히 정리되지 않아 불편하기 그지없습니다. 아무쪼록 내용은 어디까지나 참고만 하시고, 본 내용은 모두 OpenVidu가 제공하는 범위 내에 모두 설명되어 있기 때문에 OpenVidu를 사용하여 환경을 구축하면서 만났던 에러 상황을 어떻게 풀어나갔는지에 대해 좀 더 신경써서 쓰고자 합니다.

이번 포스팅에서는 OpenVidu의 무료 버전인 CE를 사용해서 온프레미스와 AWS서버에 배포하는 과정을 알아보면서 트러블 슈팅 중점으로 포스팅하려합니다.

OpenVidu는 앞서 말씀드린 것 처럼 3가지 버전으로 제공하고 있습니다. CE, PRO, ENTERPRISE 입니다. 그 중에서도 무료로 제공되는 CE를 다룰 것 인데요, CE를 온프레미스에 설치하고 어떻게 테스트했는지를 공유하겠습니다. 먼저 온프레미스 기준으로 설명을 하고 AWS 서버 환경에서 설명하겠습니다.

## 개발 환경

1. fastify (or express)
2. openvidu 2.25.0
3. openvidu-browser 2.25.0
4. openvidu-node-client 2.25.0
5. vanilla (or react)
6. vite
7. docker
8. docker-compose
9. aws ec2 t3.micro * 2 (각각 오픈비두, back + front 용)

> aws는 과금이 발생하지 않도록 꼭 비용관련 계산을 하시고 사용하시기 바랍니다. 참고로 aws는 인스턴스를 중지한다고 해서 사용하지 않는 것이 아님을 알아두시기 바랍니다. (아예 삭제해야합니다.)

## OpenVidu와 백엔드 서버 연결

총 3가지를 연결시켜야 원활하게 작동합니다. openvidu-dev의 경우와 거의 같습니다. 먼저 OpenVidu를 설치하고, 컨테이너를 실행합니다.

```bash
# opt 디렉토리로 이동하여 설치해야합니다.
cd /opt
# openvidu 설치
curl https://s3-eu-west-1.amazonaws.com/aws.openvidu.io/install_openvidu_latest.sh | bash
```

그러면 openvidu라는 디렉토리가 생깁니다. 경로는 `/opt/openvidu`가 되겠습니다. `openvidu`로 이동하면 openvidu 파일과 docker-compose.yml, .env 등이 생성되는데요, 우리가 다루어야 할 부분은 이 3가지이지만 특히나 .env를 자주 만지게 됩니다.

도메인(or public ip)과 레코딩 여부, tls 설정 등등 여러가지를 할 수 있고, 변수를 쉽게 설정할 수 있도록 이미 다 세팅이 되어있으니 설명만 잘 읽고 필요한 부분의 값을 수정해주기면 하면 됩니다.

기본적으로 필요한 설정은 바로 `DOMAIN_OR_PUBLIC_IP`와 `OPENVIDU_SECRET`값입니다. `CERTIFICATE_TYPE`은 먼저 실행시키는 것이 우선이기에 `selfsigned`로 맞춰두고 진행했습니다.
이제 설정이 끝났으면 openvidu를 실행하고 접속하여 제대로 응답하는지 봅시다.

```bash
# /opt/openvidu
./openvidu start
```

간단한 명령을 입력하면 시작과 함께 실시간 openvidu 로그로 화면이 바뀝니다. `ctrl + c`로 꺼주면 됩니다. 여기서 사용될 openvidu의 경로는 두 가지입니다.

1. http://<ip>:5443
2. https://<ip>

5443포트는 백엔드와 연결 할 때 사용하며 openvidu 객체 인스턴스 생성 시 필요합니다.

---

📚 함께 보면 좋은 내용

[devkimson blog - webrtc 환경구축 포스팅 3편](https://kkn1125.github.io/webrtc03/)

[devkimson blog - webrtc 환경구축 포스팅 2편](https://kkn1125.github.io/webrtc02/)

[openvidu docs](https://docs.openvidu.io/en/stable/)
